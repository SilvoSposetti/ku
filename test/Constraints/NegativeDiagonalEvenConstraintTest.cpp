
#include "NegativeDiagonalEvenConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("NegativeDiagonalEvenConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<NegativeDiagonalEvenConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      GENERATE_SUBCASE(NegativeDiagonalEvenConstraint, 2, 2, 5);
      GENERATE_SUBCASE(NegativeDiagonalEvenConstraint, 3, 3, 3);
      GENERATE_SUBCASE(NegativeDiagonalEvenConstraint, 7, 7, 4);
      GENERATE_SUBCASE(NegativeDiagonalEvenConstraint, 8, 8, 2);
    }

    SUBCASE("Not Supported") {
      // No even digits
      CHECK(!NegativeDiagonalEvenConstraint<PuzzleIntrinsics<{5, 5, 0}>{}>().supportsPuzzle());
      CHECK(!NegativeDiagonalEvenConstraint<PuzzleIntrinsics<{5, 5, 1}>{}>().supportsPuzzle());
      // Not square
      CHECK(!NegativeDiagonalEvenConstraint<PuzzleIntrinsics<{1, 3, 5}>{}>().supportsPuzzle());
      CHECK(!NegativeDiagonalEvenConstraint<PuzzleIntrinsics<{6, 4, 5}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("2x2x0") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 0}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalEvenConstraint<intrinsics>(), 0, {}, 0, {});
      }

      SUBCASE("2x2x2") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 2}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(NegativeDiagonalEvenConstraint<intrinsics>(),
                                                                        2,
                                                                        std::vector<Option<1>>{
                                                                            {},
                                                                            {0},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {1},
                                                                        },
                                                                        0,
                                                                        {});
      }

      SUBCASE("5x5x7") {
        constexpr auto intrinsics = PuzzleIntrinsics<{5, 5, 7}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalEvenConstraint<intrinsics>(),
            5,
            std::vector<Option<1>>{
                {}, {0}, {}, {0}, {}, {0}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {1},
                {}, {1}, {}, {1}, {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {2}, {}, {2},
                {}, {2}, {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {3}, {}, {3}, {}, {3},
                {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {4}, {}, {4}, {}, {4}, {},
            },
            0,
            {});
      }

      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalEvenConstraint<intrinsics>(),
            9,
            std::vector<Option<1>>{
                {}, {0}, {}, {0}, {}, {0}, {}, {0}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {1},
                {}, {1}, {}, {1}, {}, {1}, {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {2}, {}, {2},
                {}, {2}, {}, {2}, {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {3}, {}, {3}, {}, {3},
                {}, {3}, {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {4}, {}, {4}, {}, {4}, {}, {4},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {5}, {}, {5}, {}, {5}, {}, {5}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {6}, {}, {6}, {}, {6}, {}, {6}, {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {7}, {}, {7}, {}, {7}, {}, {7}, {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {8}, {}, {8}, {}, {8}, {}, {8}, {},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Negative-Diagonal-Even" stroke="black" stroke-width="0.889">
<path d="M 0,0 C 7.08,0.794 7.08,0.794 7.874,7.874 S 8.668,14.954 15.748,15.748 S 22.828,16.542 23.622,23.622 S 24.416,30.702 31.496,31.496 S 38.576,32.29 39.37,39.37 S 40.164,46.45 47.244,47.244 S 54.324,48.038 55.118,55.118 S 55.912,62.198 62.992,62.992 S 70.072,63.786 70.866,70.866 S 71.66,77.946 78.74,78.74 S 85.82,79.534 86.614,86.614 S 87.408,93.694 94.488,94.488 S 101.568,95.283 102.362,102.362 S 103.157,109.442 110.236,110.236 S 117.316,111.031 118.11,118.11 S 118.905,125.19 125.984,125.984 S 133.064,126.779 133.858,133.858 S 134.653,140.938 141.732,141.732 S 148.812,142.527 149.606,149.606 S 150.401,156.686 157.48,157.48 S 164.56,158.275 165.354,165.354 S 166.149,172.434 173.228,173.228 S 180.308,174.023 181.102,181.102 S 181.897,188.182 188.976,188.976 S 196.056,189.771 196.85,196.85 S 197.645,203.93 204.724,204.724 S 211.804,205.519 212.598,212.598 S 213.393,219.678 220.472,220.472 S 227.552,221.267 228.346,228.346 S 229.141,235.426 236.22,236.22 S 243.3,237.015 244.094,244.094 S 244.889,251.174 251.969,251.969 S 259.048,252.763 259.843,259.843 S 260.637,266.922 267.717,267.717 S 274.796,268.511 275.591,275.591 S 276.385,282.67 283.465,283.465 S 290.544,284.259 291.339,291.339 S 292.133,298.418 299.213,299.213 S 306.292,300.007 307.087,307.087 S 307.881,314.166 314.961,314.961 S 322.04,315.755 322.835,322.835 S 323.629,329.914 330.709,330.709 S 337.788,331.503 338.583,338.583 S 339.377,345.662 346.457,346.457 S 353.536,347.251 354.331,354.331 S 355.125,361.41 362.205,362.205 S 369.284,362.999 370.079,370.079 S 370.873,377.158 377.953,377.953 S 385.032,378.747 385.827,385.827 S 386.621,392.906 393.701,393.701 S 400.78,394.495 401.575,401.575 S 402.369,408.655 409.449,409.449 S 416.529,410.243 417.323,417.323 S 418.117,424.403 425.197,425.197 S 432.277,425.991 433.071,433.071 S 433.865,440.151 440.945,440.945 S 448.025,441.739 448.819,448.819 S 449.613,455.899 456.693,456.693 S 463.773,457.487 464.567,464.567 S 465.361,471.647 472.441,472.441 S 479.521,473.235 480.315,480.315 S 481.109,487.395 488.189,488.189 S 495.269,488.983 496.063,496.063 S 496.857,503.143 503.937,503.937 S 511.017,504.731 511.811,511.811 S 512.605,518.891 519.685,519.685 S 526.765,520.479 527.559,527.559 S 528.353,534.639 535.433,535.433 S 542.513,536.227 543.307,543.307 S 544.101,550.387 551.181,551.181 S 558.261,551.975 559.055,559.055 S 559.849,566.135 566.929,566.929 S 574.009,567.723 574.803,574.803 S 575.597,581.883 582.677,582.677 S 589.757,583.471 590.551,590.551 S 591.345,597.631 598.425,598.425 S 605.505,599.22 606.299,606.299 S 607.094,613.379 614.173,614.173 S 621.253,614.968 622.047,622.047 S 622.842,629.127 629.921,629.921 S 637.001,630.716 637.795,637.795 S 638.59,644.875 645.669,645.669 S 652.749,646.464 653.543,653.543 S 654.338,660.623 661.417,661.417 S 668.497,662.212 669.291,669.291 S 670.086,676.371 677.165,677.165 S 684.245,677.96 685.039,685.039 S 685.834,692.119 692.913,692.913 S 699.993,693.708 700.787,700.787 S 701.582,707.867 708.661,708.661 S 715.741,709.456 716.535,716.535 S 717.33,723.615 724.409,724.409 S 731.489,725.204 732.283,732.283 S 733.078,739.363 740.157,740.157 S 747.237,740.952 748.031,748.031 S 748.826,755.111 755.906,755.906 S 762.985,756.7 763.78,763.78 S 764.574,770.859 771.654,771.654 S 778.733,772.448 779.528,779.528 S 780.322,786.607 787.402,787.402 S 794.481,788.196 795.276,795.276 S 796.07,802.355 803.15,803.15 S 810.229,803.944 811.024,811.024 S 811.818,818.103 818.898,818.898 S 825.977,819.692 826.772,826.772 S 827.566,833.851 834.646,834.646 S 841.725,835.44 842.52,842.52 S 843.314,849.599 850.394,850.394 S 857.473,851.188 858.268,858.268 S 859.062,865.347 866.142,866.142 S 873.221,866.936 874.016,874.016 S 874.81,881.095 881.89,881.89 S 888.969,882.684 889.764,889.764 S 890.558,896.843 897.638,897.638 S 904.717,898.432 905.512,905.512 S 906.306,912.592 913.386,913.386 S 920.466,914.18 921.26,921.26 S 922.054,928.34 929.134,929.134 S 936.214,929.928 937.008,937.008 S 937.802,944.088 944.882,944.882 S 951.962,945.676 952.756,952.756 S 953.55,959.836 960.63,960.63 S 967.71,961.424 968.504,968.504 S 969.298,975.584 976.378,976.378 S 983.458,977.172 984.252,984.252 S 985.046,991.332 992.126,992.126 S 999.206,992.92 1000,1000" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, NegativeDiagonalEvenConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }

      SUBCASE("3x3x3") {
        constexpr auto space = PuzzleSpace{3, 3, 3};
        const auto expected = R"(<g id="Negative-Diagonal-Even" stroke="black" stroke-width="0.889">
<path d="M 0,0 C 21.333,2.477 21.333,2.477 23.81,23.81 S 26.286,45.142 47.619,47.619 S 68.952,50.096 71.429,71.429 S 73.905,92.761 95.238,95.238 S 116.571,97.715 119.048,119.048 S 121.524,140.38 142.857,142.857 S 164.19,145.334 166.667,166.667 S 169.143,188 190.476,190.476 S 211.809,192.953 214.286,214.286 S 216.762,235.619 238.095,238.095 S 259.428,240.572 261.905,261.905 S 264.381,283.238 285.714,285.714 S 307.047,288.191 309.524,309.524 S 312,330.857 333.333,333.333 S 354.666,335.81 357.143,357.143 S 359.62,378.476 380.952,380.952 S 402.285,383.429 404.762,404.762 S 407.239,426.095 428.571,428.571 S 449.904,431.048 452.381,452.381 S 454.858,473.714 476.19,476.19 S 497.523,478.667 500,500 S 502.477,521.333 523.81,523.81 S 545.142,526.286 547.619,547.619 S 550.096,568.952 571.429,571.429 S 592.761,573.905 595.238,595.238 S 597.715,616.571 619.048,619.048 S 640.38,621.524 642.857,642.857 S 645.334,664.19 666.667,666.667 S 688,669.143 690.476,690.476 S 692.953,711.809 714.286,714.286 S 735.619,716.762 738.095,738.095 S 740.572,759.428 761.905,761.905 S 783.238,764.381 785.714,785.714 S 788.191,807.047 809.524,809.524 S 830.857,812 833.333,833.333 S 835.81,854.666 857.143,857.143 S 878.476,859.62 880.952,880.952 S 883.429,902.285 904.762,904.762 S 926.095,907.239 928.571,928.571 S 931.048,949.904 952.381,952.381 S 973.714,954.858 976.19,976.19 S 978.667,997.523 1000,1000" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, NegativeDiagonalEvenConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }
    }
  }
}
