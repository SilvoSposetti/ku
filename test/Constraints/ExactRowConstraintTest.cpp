#include "ExactRowConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("ExactRowConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<ExactRowConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      // Cases with zero
      GENERATE_SUBCASE(ExactRowConstraint, 0, 0, 0);
      GENERATE_SUBCASE(ExactRowConstraint, 1, 0, 0);
      GENERATE_SUBCASE(ExactRowConstraint, 0, 1, 1);
      // Regular cases
      GENERATE_SUBCASE(ExactRowConstraint, 1, 1, 1);
      GENERATE_SUBCASE(ExactRowConstraint, 5, 2, 2);
      GENERATE_SUBCASE(ExactRowConstraint, 9, 7, 7);
      GENERATE_SUBCASE(ExactRowConstraint, 12, 5, 5);
    }

    SUBCASE("Not supported") {
      // Columns don't match with digits
      CHECK(!ExactRowConstraint<PuzzleIntrinsics<{5, 8, 5}>{}>().supportsPuzzle());
      CHECK(!ExactRowConstraint<PuzzleIntrinsics<{7, 7, 6}>{}>().supportsPuzzle());
      CHECK(!ExactRowConstraint<PuzzleIntrinsics<{5, 1, 0}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("4x4x4") {
        constexpr auto intrinsics = PuzzleIntrinsics<{4, 4, 4}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            ExactRowConstraint<intrinsics>(),
            16,
            std::vector<Option<1>>{
                {0},  {1},  {2},  {3},  {0},  {1},  {2},  {3},  {0},  {1},  {2},  {3},  {0},  {1},  {2},  {3},
                {4},  {5},  {6},  {7},  {4},  {5},  {6},  {7},  {4},  {5},  {6},  {7},  {4},  {5},  {6},  {7},
                {8},  {9},  {10}, {11}, {8},  {9},  {10}, {11}, {8},  {9},  {10}, {11}, {8},  {9},  {10}, {11},
                {12}, {13}, {14}, {15}, {12}, {13}, {14}, {15}, {12}, {13}, {14}, {15}, {12}, {13}, {14}, {15},
            },
            0,
            {});
      }

      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            ExactRowConstraint<intrinsics>(),
            81,
            std::vector<Option<1>>{
                {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},
                {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},
                {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},
                {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},
                {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12},
                {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11},
                {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10},
                {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},
                {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17},
                {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25},
                {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24},
                {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23},
                {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22},
                {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21},
                {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29},
                {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28},
                {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27},
                {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35},
                {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34},
                {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41}, {42},
                {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41},
                {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40},
                {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39},
                {40}, {41}, {42}, {43}, {44}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47},
                {48}, {49}, {50}, {51}, {52}, {53}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {45}, {46},
                {47}, {48}, {49}, {50}, {51}, {52}, {53}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {45},
                {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53},
                {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52},
                {53}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60},
                {61}, {62}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {54}, {55}, {56}, {57}, {58}, {59},
                {60}, {61}, {62}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {54}, {55}, {56}, {57}, {58},
                {59}, {60}, {61}, {62}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {54}, {55}, {56}, {57},
                {58}, {59}, {60}, {61}, {62}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {54}, {55}, {56},
                {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63}, {64},
                {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63},
                {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71},
                {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70},
                {71}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {63}, {64}, {65}, {66}, {67}, {68}, {69},
                {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76}, {77},
                {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76},
                {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75},
                {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74},
                {75}, {76}, {77}, {78}, {79}, {80}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Row" stroke="black" stroke-width="0.889">
<line x1="0" y1="0" x2="1000" y2="0"/>
<line x1="0" y1="111.111" x2="1000" y2="111.111"/>
<line x1="0" y1="222.222" x2="1000" y2="222.222"/>
<line x1="0" y1="333.333" x2="1000" y2="333.333"/>
<line x1="0" y1="444.444" x2="1000" y2="444.444"/>
<line x1="0" y1="555.556" x2="1000" y2="555.556"/>
<line x1="0" y1="666.667" x2="1000" y2="666.667"/>
<line x1="0" y1="777.778" x2="1000" y2="777.778"/>
<line x1="0" y1="888.889" x2="1000" y2="888.889"/>
<line x1="0" y1="1000" x2="1000" y2="1000"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, ExactRowConstraint<PuzzleIntrinsics<space>{}>>(expected);
      }

      SUBCASE("1x4x3") {
        constexpr auto space = PuzzleSpace{1, 4, 3};
        const auto expected = R"(<g id="Row" stroke="black" stroke-width="0.889">
<line x1="0" y1="0" x2="1000" y2="0"/>
<line x1="0" y1="250" x2="1000" y2="250"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, ExactRowConstraint<PuzzleIntrinsics<space>{}>>(expected);
      }
    }
  }
}
