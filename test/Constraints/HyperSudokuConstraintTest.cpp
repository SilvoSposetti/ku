
#include "HyperSudokuConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("HyperSudokuConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<HyperSudokuConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      // Only works with sudoku puzzle
      GENERATE_SUBCASE(HyperSudokuConstraint, 9, 9, 9);
    }

    SUBCASE("Not supported") {
      // Not 9 rows
      CHECK(!HyperSudokuConstraint<PuzzleIntrinsics<{5, 9, 9}>{}>().supportsPuzzle());
      // Not 9 columns
      CHECK(!HyperSudokuConstraint<PuzzleIntrinsics<{9, 12, 9}>{}>().supportsPuzzle());
      // Not 9 digits
      CHECK(!HyperSudokuConstraint<PuzzleIntrinsics<{9, 9, 8}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            HyperSudokuConstraint<intrinsics>(),
            36,
            std::vector<Option<1>>{
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},
                {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {},   {},
                {},   {},   {},   {},   {},   {},   {},   {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},
                {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},
                {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {},   {},   {},   {},   {},   {},
                {},   {},   {},   {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13},
                {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {0},  {1},  {2},
                {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {0},  {1},
                {2},  {3},  {4},  {5},  {6},  {7},  {8},  {},   {},   {},   {},   {},   {},   {},   {},   {},   {9},
                {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17},
                {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19},
                {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {},
                {},   {},   {},   {},   {},   {},   {},   {},   {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35},
                {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34},
                {35}, {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23},
                {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {},   {},   {},   {},   {},
                {},   {},   {},   {},   {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30},
                {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {18}, {19},
                {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {18},
                {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {},   {},   {},   {},   {},   {},   {},   {},   {},
                {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34},
                {35}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
                {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},   {},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Hyper-Sudoku" fill="transparent" stroke="black" stroke-width="2.667">
<rect x="111.111" y="111.111" width="333.333" height="333.333"/>
<rect x="111.111" y="555.556" width="333.333" height="333.333"/>
<rect x="555.556" y="111.111" width="333.333" height="333.333"/>
<rect x="555.556" y="555.556" width="333.333" height="333.333"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, HyperSudokuConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }
    }
  }
}
