
#include "ExactColumnConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("ExactColumnConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<ExactColumnConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      // Cases with zero
      GENERATE_SUBCASE(ExactColumnConstraint, 0, 0, 0);
      GENERATE_SUBCASE(ExactColumnConstraint, 0, 1, 0);
      GENERATE_SUBCASE(ExactColumnConstraint, 1, 0, 1);
      // Regular cases
      GENERATE_SUBCASE(ExactColumnConstraint, 1, 1, 1);
      GENERATE_SUBCASE(ExactColumnConstraint, 2, 5, 2);
      GENERATE_SUBCASE(ExactColumnConstraint, 7, 9, 7);
      GENERATE_SUBCASE(ExactColumnConstraint, 5, 12, 5);
    }

    SUBCASE("Not supported") {
      // Rows don't match with digits
      CHECK(!ExactColumnConstraint<PuzzleIntrinsics<{8, 5, 5}>{}>().supportsPuzzle());
      CHECK(!ExactColumnConstraint<PuzzleIntrinsics<{7, 7, 6}>{}>().supportsPuzzle());
      CHECK(!ExactColumnConstraint<PuzzleIntrinsics<{1, 5, 0}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("4x4x4") {
        constexpr auto intrinsics = PuzzleIntrinsics<{4, 4, 4}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            ExactColumnConstraint<intrinsics>(),
            16,
            std::vector<Option<1>>{
                {0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15},
                {0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15},
                {0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15},
                {0}, {1}, {2}, {3}, {4}, {5}, {6}, {7}, {8}, {9}, {10}, {11}, {12}, {13}, {14}, {15},
            },
            0,
            {});
      }

      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            ExactColumnConstraint<intrinsics>(),
            81,
            std::vector<Option<1>>{
                {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16},
                {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33},
                {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49}, {50},
                {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67},
                {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},  {3},
                {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20},
                {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37},
                {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54},
                {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71},
                {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},
                {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24},
                {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41},
                {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58},
                {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75},
                {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11},
                {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28},
                {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45},
                {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62},
                {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79},
                {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15},
                {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32},
                {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49},
                {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66},
                {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},
                {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19},
                {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36},
                {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53},
                {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70},
                {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},
                {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23},
                {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40},
                {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57},
                {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74},
                {75}, {76}, {77}, {78}, {79}, {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10},
                {11}, {12}, {13}, {14}, {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27},
                {28}, {29}, {30}, {31}, {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44},
                {45}, {46}, {47}, {48}, {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61},
                {62}, {63}, {64}, {65}, {66}, {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78},
                {79}, {80}, {0},  {1},  {2},  {3},  {4},  {5},  {6},  {7},  {8},  {9},  {10}, {11}, {12}, {13}, {14},
                {15}, {16}, {17}, {18}, {19}, {20}, {21}, {22}, {23}, {24}, {25}, {26}, {27}, {28}, {29}, {30}, {31},
                {32}, {33}, {34}, {35}, {36}, {37}, {38}, {39}, {40}, {41}, {42}, {43}, {44}, {45}, {46}, {47}, {48},
                {49}, {50}, {51}, {52}, {53}, {54}, {55}, {56}, {57}, {58}, {59}, {60}, {61}, {62}, {63}, {64}, {65},
                {66}, {67}, {68}, {69}, {70}, {71}, {72}, {73}, {74}, {75}, {76}, {77}, {78}, {79}, {80},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Column" stroke="black" stroke-width="0.889">
<line x1="0" y1="0" x2="0" y2="1000"/>
<line x1="111.111" y1="0" x2="111.111" y2="1000"/>
<line x1="222.222" y1="0" x2="222.222" y2="1000"/>
<line x1="333.333" y1="0" x2="333.333" y2="1000"/>
<line x1="444.444" y1="0" x2="444.444" y2="1000"/>
<line x1="555.556" y1="0" x2="555.556" y2="1000"/>
<line x1="666.667" y1="0" x2="666.667" y2="1000"/>
<line x1="777.778" y1="0" x2="777.778" y2="1000"/>
<line x1="888.889" y1="0" x2="888.889" y2="1000"/>
<line x1="1000" y1="0" x2="1000" y2="1000"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, ExactColumnConstraint<PuzzleIntrinsics<space>{}>>(expected);
      }

      SUBCASE("4x2x3") {
        constexpr auto space = PuzzleSpace{4, 2, 3};
        const auto expected = R"(<g id="Column" stroke="black" stroke-width="0.889">
<line x1="0" y1="0" x2="0" y2="2000"/>
<line x1="500" y1="0" x2="500" y2="2000"/>
<line x1="1000" y1="0" x2="1000" y2="2000"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, ExactColumnConstraint<PuzzleIntrinsics<space>{}>>(expected);
      }
    }
  }
}
