#include "PositiveDiagonalEvenConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("PositiveDiagonalEvenConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<PositiveDiagonalEvenConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      GENERATE_SUBCASE(PositiveDiagonalEvenConstraint, 2, 2, 5);
      GENERATE_SUBCASE(PositiveDiagonalEvenConstraint, 3, 3, 3);
      GENERATE_SUBCASE(PositiveDiagonalEvenConstraint, 7, 7, 4);
      GENERATE_SUBCASE(PositiveDiagonalEvenConstraint, 8, 8, 2);
    }

    SUBCASE("Not Supported") {
      // No even digits
      CHECK(!PositiveDiagonalEvenConstraint<PuzzleIntrinsics<{5, 5, 0}>{}>().supportsPuzzle());
      CHECK(!PositiveDiagonalEvenConstraint<PuzzleIntrinsics<{5, 5, 1}>{}>().supportsPuzzle());
      // Not square
      CHECK(!PositiveDiagonalEvenConstraint<PuzzleIntrinsics<{1, 3, 5}>{}>().supportsPuzzle());
      CHECK(!PositiveDiagonalEvenConstraint<PuzzleIntrinsics<{6, 4, 5}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("2x2x0") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 0}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            PositiveDiagonalEvenConstraint<intrinsics>(), 0, {}, 0, {});
      }

      SUBCASE("2x2x2") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 2}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(PositiveDiagonalEvenConstraint<intrinsics>(),
                                                                        2,
                                                                        std::vector<Option<1>>{
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {0},
                                                                            {},
                                                                            {1},
                                                                            {},
                                                                            {},
                                                                        },
                                                                        0,
                                                                        {});
      }

      SUBCASE("5x5x7") {
        constexpr auto intrinsics = PuzzleIntrinsics<{5, 5, 7}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            PositiveDiagonalEvenConstraint<intrinsics>(),
            5,
            std::vector<Option<1>>{
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {0}, {}, {0}, {}, {0}, {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {1}, {}, {1}, {}, {1}, {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {2}, {}, {2},
                {}, {2}, {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {3}, {}, {3}, {}, {3}, {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {4}, {}, {4}, {}, {4}, {}, {},  {}, {},  {}, {},  {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
            },
            0,
            {});
      }

      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            PositiveDiagonalEvenConstraint<intrinsics>(),
            9,
            std::vector<Option<1>>{
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {0}, {}, {0}, {}, {0}, {}, {0}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {1}, {}, {1}, {}, {1}, {}, {1}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {2}, {}, {2}, {}, {2}, {}, {2}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {3}, {}, {3}, {}, {3}, {}, {3}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {4}, {}, {4}, {}, {4}, {}, {4}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {5}, {}, {5}, {}, {5}, {}, {5}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {6}, {}, {6}, {}, {6}, {}, {6}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {7}, {}, {7}, {}, {7}, {}, {7}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {8}, {}, {8}, {}, {8}, {}, {8}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {}, {},
                {}, {},  {}, {},  {}, {},  {}, {},  {},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Positive-Diagonal-Even" stroke="black" stroke-width="0.889">
<path d="M 0,1000 C 0.794,992.92 0.794,992.92 7.874,992.126 S 14.954,991.332 15.748,984.252 S 16.542,977.172 23.622,976.378 S 30.702,975.584 31.496,968.504 S 32.29,961.424 39.37,960.63 S 46.45,959.836 47.244,952.756 S 48.038,945.676 55.118,944.882 S 62.198,944.088 62.992,937.008 S 63.786,929.928 70.866,929.134 S 77.946,928.34 78.74,921.26 S 79.534,914.18 86.614,913.386 S 93.694,912.592 94.488,905.512 S 95.283,898.432 102.362,897.638 S 109.442,896.843 110.236,889.764 S 111.031,882.684 118.11,881.89 S 125.19,881.095 125.984,874.016 S 126.779,866.936 133.858,866.142 S 140.938,865.347 141.732,858.268 S 142.527,851.188 149.606,850.394 S 156.686,849.599 157.48,842.52 S 158.275,835.44 165.354,834.646 S 172.434,833.851 173.228,826.772 S 174.023,819.692 181.102,818.898 S 188.182,818.103 188.976,811.024 S 189.771,803.944 196.85,803.15 S 203.93,802.355 204.724,795.276 S 205.519,788.196 212.598,787.402 S 219.678,786.607 220.472,779.528 S 221.267,772.448 228.346,771.654 S 235.426,770.859 236.22,763.78 S 237.015,756.7 244.094,755.906 S 251.174,755.111 251.969,748.031 S 252.763,740.952 259.843,740.157 S 266.922,739.363 267.717,732.283 S 268.511,725.204 275.591,724.409 S 282.67,723.615 283.465,716.535 S 284.259,709.456 291.339,708.661 S 298.418,707.867 299.213,700.787 S 300.007,693.708 307.087,692.913 S 314.166,692.119 314.961,685.039 S 315.755,677.96 322.835,677.165 S 329.914,676.371 330.709,669.291 S 331.503,662.212 338.583,661.417 S 345.662,660.623 346.457,653.543 S 347.251,646.464 354.331,645.669 S 361.41,644.875 362.205,637.795 S 362.999,630.716 370.079,629.921 S 377.158,629.127 377.953,622.047 S 378.747,614.968 385.827,614.173 S 392.906,613.379 393.701,606.299 S 394.495,599.22 401.575,598.425 S 408.655,597.631 409.449,590.551 S 410.243,583.471 417.323,582.677 S 424.403,581.883 425.197,574.803 S 425.991,567.723 433.071,566.929 S 440.151,566.135 440.945,559.055 S 441.739,551.975 448.819,551.181 S 455.899,550.387 456.693,543.307 S 457.487,536.227 464.567,535.433 S 471.647,534.639 472.441,527.559 S 473.235,520.479 480.315,519.685 S 487.395,518.891 488.189,511.811 S 488.983,504.731 496.063,503.937 S 503.143,503.143 503.937,496.063 S 504.731,488.983 511.811,488.189 S 518.891,487.395 519.685,480.315 S 520.479,473.235 527.559,472.441 S 534.639,471.647 535.433,464.567 S 536.227,457.487 543.307,456.693 S 550.387,455.899 551.181,448.819 S 551.975,441.739 559.055,440.945 S 566.135,440.151 566.929,433.071 S 567.723,425.991 574.803,425.197 S 581.883,424.403 582.677,417.323 S 583.471,410.243 590.551,409.449 S 597.631,408.655 598.425,401.575 S 599.22,394.495 606.299,393.701 S 613.379,392.906 614.173,385.827 S 614.968,378.747 622.047,377.953 S 629.127,377.158 629.921,370.079 S 630.716,362.999 637.795,362.205 S 644.875,361.41 645.669,354.331 S 646.464,347.251 653.543,346.457 S 660.623,345.662 661.417,338.583 S 662.212,331.503 669.291,330.709 S 676.371,329.914 677.165,322.835 S 677.96,315.755 685.039,314.961 S 692.119,314.166 692.913,307.087 S 693.708,300.007 700.787,299.213 S 707.867,298.418 708.661,291.339 S 709.456,284.259 716.535,283.465 S 723.615,282.67 724.409,275.591 S 725.204,268.511 732.283,267.717 S 739.363,266.922 740.157,259.843 S 740.952,252.763 748.031,251.969 S 755.111,251.174 755.906,244.094 S 756.7,237.015 763.78,236.22 S 770.859,235.426 771.654,228.346 S 772.448,221.267 779.528,220.472 S 786.607,219.678 787.402,212.598 S 788.196,205.519 795.276,204.724 S 802.355,203.93 803.15,196.85 S 803.944,189.771 811.024,188.976 S 818.103,188.182 818.898,181.102 S 819.692,174.023 826.772,173.228 S 833.851,172.434 834.646,165.354 S 835.44,158.275 842.52,157.48 S 849.599,156.686 850.394,149.606 S 851.188,142.527 858.268,141.732 S 865.347,140.938 866.142,133.858 S 866.936,126.779 874.016,125.984 S 881.095,125.19 881.89,118.11 S 882.684,111.031 889.764,110.236 S 896.843,109.442 897.638,102.362 S 898.432,95.283 905.512,94.488 S 912.592,93.694 913.386,86.614 S 914.18,79.534 921.26,78.74 S 928.34,77.946 929.134,70.866 S 929.928,63.786 937.008,62.992 S 944.088,62.198 944.882,55.118 S 945.676,48.038 952.756,47.244 S 959.836,46.45 960.63,39.37 S 961.424,32.29 968.504,31.496 S 975.584,30.702 976.378,23.622 S 977.172,16.542 984.252,15.748 S 991.332,14.954 992.126,7.874 S 992.92,0.794 1000,0" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, PositiveDiagonalEvenConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }

      SUBCASE("3x3x3") {
        constexpr auto space = PuzzleSpace{3, 3, 3};
        const auto expected = R"(<g id="Positive-Diagonal-Even" stroke="black" stroke-width="0.889">
<path d="M 0,1000 C 2.477,978.667 2.477,978.667 23.81,976.19 S 45.142,973.714 47.619,952.381 S 50.096,931.048 71.429,928.571 S 92.761,926.095 95.238,904.762 S 97.715,883.429 119.048,880.952 S 140.38,878.476 142.857,857.143 S 145.334,835.81 166.667,833.333 S 188,830.857 190.476,809.524 S 192.953,788.191 214.286,785.714 S 235.619,783.238 238.095,761.905 S 240.572,740.572 261.905,738.095 S 283.238,735.619 285.714,714.286 S 288.191,692.953 309.524,690.476 S 330.857,688 333.333,666.667 S 335.81,645.334 357.143,642.857 S 378.476,640.38 380.952,619.048 S 383.429,597.715 404.762,595.238 S 426.095,592.761 428.571,571.429 S 431.048,550.096 452.381,547.619 S 473.714,545.142 476.19,523.81 S 478.667,502.477 500,500 S 521.333,497.523 523.81,476.19 S 526.286,454.858 547.619,452.381 S 568.952,449.904 571.429,428.571 S 573.905,407.239 595.238,404.762 S 616.571,402.285 619.048,380.952 S 621.524,359.62 642.857,357.143 S 664.19,354.666 666.667,333.333 S 669.143,312 690.476,309.524 S 711.809,307.047 714.286,285.714 S 716.762,264.381 738.095,261.905 S 759.428,259.428 761.905,238.095 S 764.381,216.762 785.714,214.286 S 807.047,211.809 809.524,190.476 S 812,169.143 833.333,166.667 S 854.666,164.19 857.143,142.857 S 859.62,121.524 880.952,119.048 S 902.285,116.571 904.762,95.238 S 907.239,73.905 928.571,71.429 S 949.904,68.952 952.381,47.619 S 954.858,26.286 976.19,23.81 S 997.523,21.333 1000,0" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, PositiveDiagonalEvenConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }
    }
  }
}
