
#include "NegativeDiagonalOddConstraint.hpp"

#include "ConstraintTestHelpers.hpp"

#include <doctest.h>

TEST_SUITE("Constraints") {

  TEST_CASE("NegativeDiagonalOddConstraint") {

    SUBCASE("Members") {
      ConstraintTestHelpers::memberChecks<NegativeDiagonalOddConstraint<PuzzleIntrinsics<{0, 0, 0}>{}>>();
    }

    SUBCASE("Implicit Option Coverage") {
      GENERATE_SUBCASE(NegativeDiagonalOddConstraint, 1, 1, 1);
      GENERATE_SUBCASE(NegativeDiagonalOddConstraint, 2, 2, 5);
      GENERATE_SUBCASE(NegativeDiagonalOddConstraint, 3, 3, 3);
      GENERATE_SUBCASE(NegativeDiagonalOddConstraint, 7, 7, 4);
      GENERATE_SUBCASE(NegativeDiagonalOddConstraint, 8, 8, 2);
    }

    SUBCASE("Not supported") {
      // No odd digits
      CHECK(!NegativeDiagonalOddConstraint<PuzzleIntrinsics<{5, 5, 0}>{}>().supportsPuzzle());
      // Not square
      CHECK(!NegativeDiagonalOddConstraint<PuzzleIntrinsics<{5, 4, 5}>{}>().supportsPuzzle());
      CHECK(!NegativeDiagonalOddConstraint<PuzzleIntrinsics<{1, 7, 5}>{}>().supportsPuzzle());
    }

    SUBCASE("Explicit Options") {
      SUBCASE("2x2x0") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 0}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalOddConstraint<intrinsics>(), 0, {}, 0, {});
      }

      SUBCASE("2x2x2") {
        constexpr auto intrinsics = PuzzleIntrinsics<{2, 2, 2}>();
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(NegativeDiagonalOddConstraint<intrinsics>(),
                                                                        2,
                                                                        std::vector<Option<1>>{
                                                                            {0},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {},
                                                                            {1},
                                                                            {},
                                                                        },
                                                                        0,
                                                                        {});
      }

      SUBCASE("5x5x7") {
        constexpr auto intrinsics = PuzzleIntrinsics<{5, 5, 7}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalOddConstraint<intrinsics>(),
            5,
            std::vector<Option<1>>{
                {0}, {}, {0}, {}, {0}, {}, {0}, {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {1}, {},
                {1}, {}, {1}, {}, {1}, {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {2}, {}, {2}, {},
                {2}, {}, {2}, {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {3}, {}, {3}, {}, {3}, {},
                {3}, {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {}, {}, {}, {}, {}, {}, {}, {4}, {}, {4}, {}, {4}, {}, {4},
            },
            0,
            {});
      }

      SUBCASE("9x9x9") {
        constexpr auto intrinsics = PuzzleIntrinsics<{9, 9, 9}>{};
        ConstraintTestHelpers::checkConstraintOptions<intrinsics, 1, 0>(
            NegativeDiagonalOddConstraint<intrinsics>(),
            9,
            std::vector<Option<1>>{
                {0}, {}, {0}, {}, {0}, {}, {0}, {},  {0}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {1}, {},
                {1}, {}, {1}, {}, {1}, {}, {1}, {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {2}, {}, {2}, {},
                {2}, {}, {2}, {}, {2}, {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {3}, {}, {3}, {}, {3}, {},
                {3}, {}, {3}, {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {4}, {}, {4}, {}, {4}, {}, {4}, {},
                {4}, {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {5}, {}, {5}, {}, {5}, {}, {5}, {}, {5}, {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {6}, {}, {6}, {}, {6}, {}, {6}, {}, {6}, {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {7}, {}, {7}, {}, {7}, {}, {7}, {}, {7}, {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {},  {},  {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {}, {},  {},
                {},  {}, {},  {}, {},  {}, {},  {8}, {},  {8}, {}, {8}, {}, {8}, {}, {8},
            },
            0,
            {});
      }
    }

    SUBCASE("Drawing") {

      SUBCASE("9x9x9") {
        constexpr auto space = PuzzleSpace{9, 9, 9};
        const auto expected = R"(<g id="Negative-Diagonal-Odd" stroke="black" stroke-width="0.889">
<path d="M 0,0 L 7.08,0.794 L 8.668,14.954 L 22.828,16.542 L 24.416,30.702 L 38.576,32.29 L 40.164,46.45 L 54.324,48.038 L 55.912,62.198 L 70.072,63.786 L 71.66,77.946 L 85.82,79.534 L 87.408,93.694 L 101.568,95.283 L 103.157,109.442 L 117.316,111.031 L 118.905,125.19 L 133.064,126.779 L 134.653,140.938 L 148.812,142.527 L 150.401,156.686 L 164.56,158.275 L 166.149,172.434 L 180.308,174.023 L 181.897,188.182 L 196.056,189.771 L 197.645,203.93 L 211.804,205.519 L 213.393,219.678 L 227.552,221.267 L 229.141,235.426 L 243.3,237.015 L 244.889,251.174 L 259.048,252.763 L 260.637,266.922 L 274.796,268.511 L 276.385,282.67 L 290.544,284.259 L 292.133,298.418 L 306.292,300.007 L 307.881,314.166 L 322.04,315.755 L 323.629,329.914 L 337.788,331.503 L 339.377,345.662 L 353.536,347.251 L 355.125,361.41 L 369.284,362.999 L 370.873,377.158 L 385.032,378.747 L 386.621,392.906 L 400.78,394.495 L 402.369,408.655 L 416.529,410.243 L 418.117,424.403 L 432.277,425.991 L 433.865,440.151 L 448.025,441.739 L 449.613,455.899 L 463.773,457.487 L 465.361,471.647 L 479.521,473.235 L 481.109,487.395 L 495.269,488.983 L 496.857,503.143 L 511.017,504.731 L 512.605,518.891 L 526.765,520.479 L 528.353,534.639 L 542.513,536.227 L 544.101,550.387 L 558.261,551.975 L 559.849,566.135 L 574.009,567.723 L 575.597,581.883 L 589.757,583.471 L 591.345,597.631 L 605.505,599.22 L 607.094,613.379 L 621.253,614.968 L 622.842,629.127 L 637.001,630.716 L 638.59,644.875 L 652.749,646.464 L 654.338,660.623 L 668.497,662.212 L 670.086,676.371 L 684.245,677.96 L 685.834,692.119 L 699.993,693.708 L 701.582,707.867 L 715.741,709.456 L 717.33,723.615 L 731.489,725.204 L 733.078,739.363 L 747.237,740.952 L 748.826,755.111 L 762.985,756.7 L 764.574,770.859 L 778.733,772.448 L 780.322,786.607 L 794.481,788.196 L 796.07,802.355 L 810.229,803.944 L 811.818,818.103 L 825.977,819.692 L 827.566,833.851 L 841.725,835.44 L 843.314,849.599 L 857.473,851.188 L 859.062,865.347 L 873.221,866.936 L 874.81,881.095 L 888.969,882.684 L 890.558,896.843 L 904.717,898.432 L 906.306,912.592 L 920.466,914.18 L 922.054,928.34 L 936.214,929.928 L 937.802,944.088 L 951.962,945.676 L 953.55,959.836 L 967.71,961.424 L 969.298,975.584 L 983.458,977.172 L 985.046,991.332 L 999.206,992.92 L 1000,1000" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, NegativeDiagonalOddConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }

      SUBCASE("3x3x3") {
        constexpr auto space = PuzzleSpace{3, 3, 3};
        const auto expected = R"(<g id="Negative-Diagonal-Odd" stroke="black" stroke-width="0.889">
<path d="M 0,0 L 21.333,2.477 L 26.286,45.142 L 68.952,50.096 L 73.905,92.761 L 116.571,97.715 L 121.524,140.38 L 164.19,145.334 L 169.143,188 L 211.809,192.953 L 216.762,235.619 L 259.428,240.572 L 264.381,283.238 L 307.047,288.191 L 312,330.857 L 354.666,335.81 L 359.62,378.476 L 402.285,383.429 L 407.239,426.095 L 449.904,431.048 L 454.858,473.714 L 497.523,478.667 L 502.477,521.333 L 545.142,526.286 L 550.096,568.952 L 592.761,573.905 L 597.715,616.571 L 640.38,621.524 L 645.334,664.19 L 688,669.143 L 692.953,711.809 L 735.619,716.762 L 740.572,759.428 L 783.238,764.381 L 788.191,807.047 L 830.857,812 L 835.81,854.666 L 878.476,859.62 L 883.429,902.285 L 926.095,907.239 L 931.048,949.904 L 973.714,954.858 L 978.667,997.523 L 1000,1000" fill="transparent"/>
</g>)";
        ConstraintTestHelpers::checkConstraintSvg<space, NegativeDiagonalOddConstraint<PuzzleIntrinsics<space>{}>>(
            expected);
      }
    }
  }
}
